/**
 * Collapse long "Parameters" sections generated by autodoc.
 * Keeps short argument lists expanded for readability.
 */
document.addEventListener('DOMContentLoaded', () => {
  const fieldLists = document.querySelectorAll('dl.field-list');

  for (const fieldList of fieldLists) {
    const terms = fieldList.querySelectorAll(':scope > dt');

    for (const term of terms) {
      const label = term.textContent?.trim() ?? '';
      if (!label.startsWith('Parameters')) continue;

      const description = term.nextElementSibling;
      if (!description || description.tagName !== 'DD') continue;

      // Count parameters from either bullet-list items or nested definition terms.
      const paramCount =
        description.querySelectorAll(':scope > ul > li').length ||
        description.querySelectorAll(':scope dl > dt').length;

      if (paramCount < 8) continue;
      if (description.querySelector('details.pyinat-param-details')) continue;

      const details = document.createElement('details');
      details.className = 'pyinat-param-details';

      const summary = document.createElement('summary');
      summary.textContent = `Show parameters (${paramCount})`;
      details.append(summary);

      while (description.firstChild) {
        details.append(description.firstChild);
      }

      description.append(details);
    }
  }
});
